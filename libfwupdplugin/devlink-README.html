<!--
SPDX-FileCopyrightText: fwupd Development Team

SPDX-License-Identifier: LGPL-2.1-or-later
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <title>FwupdPlugin &ndash; 1.0: Plugin: Devlink</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta charset="utf-8" />

  
  <meta property="og:type" content="website"/>

  
  <meta property="og:image:width" content="256"/>
  <meta property="og:image:height" content="256"/>
  <meta property="og:image:secure_url" content="org.freedesktop.fwupd.svg"/>
  <meta property="og:image:alt" content="FwupdPlugin-1.0"/>
  

  
  <meta property="og:title" content="FwupdPlugin: Plugin: Devlink"/>
  <meta property="og:description" content="Reference for FwupdPlugin-1.0: Plugin: Devlink"/>
  <meta name="twitter:title" content="FwupdPlugin: Plugin: Devlink"/>
  <meta name="twitter:description" content="Reference for FwupdPlugin-1.0: Plugin: Devlink"/>


  
  <meta name="twitter:card" content="summary"/>

  
  
  
  

  <link rel="stylesheet" href="style.css" type="text/css" />

  

  
  <script src="urlmap_fwupdplugin.js"></script>
  
  
  <script src="fzy.js"></script>
  <script src="search.js"></script>
  
  <script src="main.js"></script>

  
</head>

<body>
  <div id="body-wrapper" tabindex="-1">

    <nav class="sidebar devhelp-hidden">
      
      <div class="section">
        <a href="index.html"><img src="org.freedesktop.fwupd.svg" class="logo"/></a>
      </div>
      
      
      <div class="search section">
        <form id="search-form" autocomplete="off">
          <input id="search-input" type="text" name="do-not-autocomplete" placeholder="Click, or press 's' to search" autocomplete="off"/>
        </form>
      </div>
      
      <div class="section namespace">
        <h3><a href="index.html">FwupdPlugin</a></h3>
        <p>API Version: 1.0</p>
        
        <p>Library Version: 2.0.15</p>
        
      </div>
      
      
      <div class="section generator">
        <p>Generated by <a href="https://gitlab.gnome.org/GNOME/gi-docgen">gi-docgen</a> 2025.3</p>
      </div>
    </nav>

    <button id="btn-to-top" class="hidden"><span class="up-arrow"></span></button>

    
<section id="main" class="content">
  
  <h4 id="title" style="display:flex;">
    Plugin: Devlink
    <a href="#title" class="anchor"></a>
    
  </h4>
  
  <section>
    <div class="docblock">
    <h2 id="introduction">Introduction<a class="md-anchor" href="#introduction" title="Permanent link"></a></h2>
<p>This plugin provides firmware update support for network interface cards that support the Linux devlink interface.
This is a generic plugin that can work with any device that implements devlink&nbsp;functionality.</p>
<h2 id="supported-devices">Supported Devices<a class="md-anchor" href="#supported-devices" title="Permanent link"></a></h2>
<p>The plugin supports any device that implements the devlink interface, regardless the bus it resides&nbsp;on.</p>
<h2 id="firmware-format">Firmware Format<a class="md-anchor" href="#firmware-format" title="Permanent link"></a></h2>
<p>The daemon will decompress the cabinet archive and extract a firmware blob in
a packed binary file&nbsp;format.</p>
<p>This plugin supports the following protocol <span class="caps">ID</span>:</p>
<ul>
<li><code>org.kernel.devlink</code></li>
</ul>
<h2 id="guid-generation">GUID Generation<a class="md-anchor" href="#guid-generation" title="Permanent link"></a></h2>
<p>These devices use custom instance IDs consisting of the component&nbsp;name.</p>
<ul>
<li><code>PCI\VEN_15B3&amp;DEV_1021&amp;COMPONENT_fw</code></li>
</ul>
<p>Optionally, additional <span class="caps">GUID</span> might get generated as specified in the squirk file, see&nbsp;below.</p>
<h3 id="device-identification">Device Identification<a class="md-anchor" href="#device-identification" title="Permanent link"></a></h3>
<p>Devices are identified using their in the&nbsp;format:</p>
<div class="codehilite"><pre><span></span><code>BUS_NAME/DEV_NAME
</code></pre></div>

<p>For <span class="caps">PCI</span>, this is for&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code>pci/0000:01:00.0
</code></pre></div>

<h2 id="requirements">Requirements<a class="md-anchor" href="#requirements" title="Permanent link"></a></h2>
<ul>
<li>Linux kernel with devlink&nbsp;support</li>
<li>Device driver with devlink&nbsp;implementation</li>
<li>Root privileges (required for devlink write&nbsp;commands)</li>
</ul>
<h2 id="update-behavior">Update Behavior<a class="md-anchor" href="#update-behavior" title="Permanent link"></a></h2>
<p>The plugin uses the Linux devlink netlink interface to communicate with the kernel and perform firmware updates.
The process&nbsp;involves:</p>
<ol>
<li><strong>Netlink Communication</strong>: Opens Netlink socket to communicate with the devlink&nbsp;subsystem</li>
<li><strong>Device Detection</strong>:  Gets all existing devlink&nbsp;devices</li>
<li><strong>Firmware Upload</strong>: Writes the firmware file to <code>CACHE_DIRECTORY</code> and instructs devlink to flash&nbsp;it</li>
<li><strong>Progress Monitoring</strong>: Monitors devlink status messages to provide real-time progress&nbsp;updates</li>
<li><strong>Firmware Activation</strong>: Activates firmware using devlink reload activate&nbsp;action</li>
</ol>
<h3 id="devlink-protocol">Devlink Protocol<a class="md-anchor" href="#devlink-protocol" title="Permanent link"></a></h3>
<p>The plugin implements the devlink generic netlink&nbsp;protocol:</p>
<ol>
<li><strong>Device Enumeration</strong>: Sends <code>DEVLINK_CMD_GET</code> with dump flag to discover all devlink&nbsp;devices</li>
<li><strong>Device Monitoring</strong>: Receives <code>DEVLINK_CMD_NEW</code> notifications when devices are&nbsp;added</li>
<li><strong>Device Removal</strong>: Receives <code>DEVLINK_CMD_DEL</code> notifications when devices are&nbsp;removed</li>
<li><strong>Device Information</strong>: Sends <code>DEVLINK_CMD_INFO_GET</code> to retrieve device details and&nbsp;versions</li>
<li><strong>Flash Command</strong>: Sends <code>DEVLINK_CMD_FLASH_UPDATE</code> with device and file&nbsp;information</li>
<li><strong>Status Monitoring</strong>: Receives <code>DEVLINK_CMD_FLASH_UPDATE_STATUS</code> messages for&nbsp;progress</li>
<li><strong>Completion</strong>: Waits for <code>DEVLINK_CMD_FLASH_UPDATE_END</code> to confirm&nbsp;completion</li>
<li><strong>Firmware Activation</strong>: Sends <code>DEVLINK_CMD_RELOAD</code> with fw_activate action to activate updated&nbsp;firmware</li>
</ol>
<h2 id="quirk-use">Quirk Use<a class="md-anchor" href="#quirk-use" title="Permanent link"></a></h2>
<p>This plugin uses the following plugin-specific&nbsp;quirks:</p>
<h3 id="devlinkfixedversions">DevlinkFixedVersions<a class="md-anchor" href="#devlinkfixedversions" title="Permanent link"></a></h3>
<p>Specifies a comma-separated list of &#8220;fixed version&#8221; names that should be used
to generate additional <span class="caps">GUID</span> instance IDs for component matching. This is useful to
target specific device according to device IDs, like <span class="caps">ASIC</span> <span class="caps">ID</span>, Board <span class="caps">ID</span>,&nbsp;etc.</p>
<p><strong>Example usage in quirk&nbsp;file:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">[PCI\VEN_15B3&amp;DEV_1021]</span>
<span class="na">DevlinkFixedVersions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">fw.psid</span>
</code></pre></div>

<p>Since:&nbsp;2.0.15</p>
<h2 id="private-flags">Private Flags<a class="md-anchor" href="#private-flags" title="Permanent link"></a></h2>
<p>The plugin supports the following private&nbsp;flags:</p>
<h3 id="flagsomit-component-name"><code>Flags=omit-component-name</code><a class="md-anchor" href="#flagsomit-component-name" title="Permanent link"></a></h3>
<p>When this flag is set, the plugin will not include the <code>DEVLINK_ATTR_FLASH_UPDATE_COMPONENT</code>
attribute in the flash command.
This is useful for devices that don&#8217;t support component-specific updates. For such,
passing <code>DEVLINK_ATTR_FLASH_UPDATE_COMPONENT</code> in flash netlink message
would cause an&nbsp;error.</p>
<p><strong>Usage in metainfo <span class="caps">XML</span>:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;custom&gt;</span>
<span class="w">  </span><span class="nt">&lt;value</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;LVFS::DeviceFlags&quot;</span><span class="nt">&gt;</span>omit-component-name<span class="nt">&lt;/value&gt;</span>
<span class="nt">&lt;/custom&gt;</span>
</code></pre></div>

<p>Since:&nbsp;2.0.15</p>
<h3 id="error-handling">Error Handling<a class="md-anchor" href="#error-handling" title="Permanent link"></a></h3>
<p>The plugin handles various error&nbsp;conditions:</p>
<ul>
<li>Kernel without devlink&nbsp;support</li>
<li>Device without devlink&nbsp;implementation</li>
<li>Device without devlink flash&nbsp;implementation</li>
<li>Firmware file access&nbsp;issues</li>
<li>Flash operation&nbsp;failures</li>
</ul>
<h2 id="security-considerations">Security Considerations<a class="md-anchor" href="#security-considerations" title="Permanent link"></a></h2>
<ul>
<li>Firmware files are temporarily stored in <code>/lib/firmware/</code></li>
<li>Root privileges are required for devlink write&nbsp;commands</li>
<li>Temporary files are cleaned up after the&nbsp;operation</li>
</ul>
<h2 id="vendor-id-security">Vendor ID Security<a class="md-anchor" href="#vendor-id-security" title="Permanent link"></a></h2>
<p>The vendor <span class="caps">ID</span> is set from the <span class="caps">PCI</span>&nbsp;vendor.</p>
<h2 id="external-interface-access">External Interface Access<a class="md-anchor" href="#external-interface-access" title="Permanent link"></a></h2>
<p>This plugin requires read/write access to <code>/dev/bus/usb</code>.</p>
<h2 id="version-considerations">Version Considerations<a class="md-anchor" href="#version-considerations" title="Permanent link"></a></h2>
<p>This plugin has been available since fwupd version <code>2.0.15</code>.</p>
<h2 id="owners">Owners<a class="md-anchor" href="#owners" title="Permanent link"></a></h2>
<p>Anyone can submit a pull request to modify this plugin, but the following people should be
consulted before making major or functional&nbsp;changes:</p>
<ul>
<li>Jiří Pírko: <code>jpirko</code></li>
</ul>
<h2 id="references">References<a class="md-anchor" href="#references" title="Permanent link"></a></h2>
<ul>
<li><a href="https://www.kernel.org/doc/html/latest/networking/devlink/">Linux Devlink&nbsp;Documentation</a></li>
</ul>
    </div>
  </section>
</section>


    
<div id="toc" class="toc">
  <nav aria-labelledby="toc-title">
    <p id="toc-title">Content</p>
    <ul class="toc-list">
      
        
        <li class="toc-list-item"><a href="#introduction"><span class="link-text">Introduction</span></a></li>
          
        
        <li class="toc-list-item"><a href="#supported-devices"><span class="link-text">Supported Devices</span></a></li>
          
        
        <li class="toc-list-item"><a href="#firmware-format"><span class="link-text">Firmware Format</span></a></li>
          
        
        <li class="toc-list-item"><a href="#guid-generation"><span class="link-text">GUID Generation</span></a></li>
          
          <ul class="toc-list">
          
            <li class="toc-list-item"><a href="#device-identification"><span class="link-text">Device Identification</span></a></li>
          
          </ul>
          
        
        <li class="toc-list-item"><a href="#requirements"><span class="link-text">Requirements</span></a></li>
          
        
        <li class="toc-list-item"><a href="#update-behavior"><span class="link-text">Update Behavior</span></a></li>
          
          <ul class="toc-list">
          
            <li class="toc-list-item"><a href="#devlink-protocol"><span class="link-text">Devlink Protocol</span></a></li>
          
          </ul>
          
        
        <li class="toc-list-item"><a href="#quirk-use"><span class="link-text">Quirk Use</span></a></li>
          
          <ul class="toc-list">
          
            <li class="toc-list-item"><a href="#devlinkfixedversions"><span class="link-text">DevlinkFixedVersions</span></a></li>
          
          </ul>
          
        
        <li class="toc-list-item"><a href="#private-flags"><span class="link-text">Private Flags</span></a></li>
          
          <ul class="toc-list">
          
            <li class="toc-list-item"><a href="#flagsomit-component-name"><span class="link-text">Flags=omit-component-name</span></a></li>
          
            <li class="toc-list-item"><a href="#error-handling"><span class="link-text">Error Handling</span></a></li>
          
          </ul>
          
        
        <li class="toc-list-item"><a href="#security-considerations"><span class="link-text">Security Considerations</span></a></li>
          
        
        <li class="toc-list-item"><a href="#vendor-id-security"><span class="link-text">Vendor ID Security</span></a></li>
          
        
        <li class="toc-list-item"><a href="#external-interface-access"><span class="link-text">External Interface Access</span></a></li>
          
        
        <li class="toc-list-item"><a href="#version-considerations"><span class="link-text">Version Considerations</span></a></li>
          
        
        <li class="toc-list-item"><a href="#owners"><span class="link-text">Owners</span></a></li>
          
        
        <li class="toc-list-item"><a href="#references"><span class="link-text">References</span></a></li>
          
        
      
    </ul>
  </nav>
</div>


    <section id="search" class="content hidden"></section>

    <footer>
    
    </footer>
  </div>
</body>
</html>